<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="SHEN : Erlang JavaScript Parse Transform" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>SHEN</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/5HT/shen">View on GitHub</a>

          <h1 id="project_title">SHEN</h1>
          <h2 id="project_tagline">Erlang JavaScript Parse Transform</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/5HT/shen/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/5HT/shen/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="erlang-javascript-parse-transform" class="anchor" href="#erlang-javascript-parse-transform"><span class="octicon octicon-link"></span></a>Erlang JavaScript Parse Transform</h1>

<p>Till now all existed attempts to bring Erlang to the browser is nothing than playing with mind.
No emulation of terrible Erlang bytecode is needed. In fact Erlang bytecode is relict
that is even translated by BEAM into more modern internal bytecode. So every project
that attempt to translate on BEAM byte-code level not only slow but in fact is a useless.</p>

<h2>
<a name="libraries" class="anchor" href="#libraries"><span class="octicon octicon-link"></span></a>Libraries</h2>

<p>We support following stack by Erlang JavaScript compiler:</p>

<ul>
<li>matches.js -- Erlang-like matching syntax</li>
<li>tailrec.js -- optimize tail calls</li>
<li>beacon.js -- FRP event streaming</li>
</ul><p>The only real pratical fast solution is to translate Erlang AST into JavaScript
using JavaScript helpers like matches.js and tailrec.js.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li>Compilation to JavaScript, node.js, Browser, Client-Side FRP</li>
<li>Macros, String Templates, Embedding Mode, Server-Side, N2O</li>
</ul><h2>
<a name="compilation-to-pure-javascript" class="anchor" href="#compilation-to-pure-javascript"><span class="octicon octicon-link"></span></a>Compilation to Pure JavaScript</h2>

<p>In case of Client-Logic, Off-line clients, Client-side FRP Event System
use can export you functions in module with -js attribute.
All function will be stored to the same filename with js extension.</p>

<p>fac.erl:</p>

<div class="highlight highlight-erlang"><pre>    <span class="o">-</span><span class="n">module</span><span class="p">(</span><span class="n">fac</span><span class="p">).</span>
    <span class="o">-</span><span class="n">compile</span><span class="p">({</span><span class="n">parse_transform</span><span class="p">,</span> <span class="n">shen</span><span class="p">}).</span>
    <span class="o">-</span><span class="n">compile</span><span class="p">(</span><span class="n">export_all</span><span class="p">).</span>

    <span class="o">-</span><span class="n">js</span><span class="p">([</span><span class="n">start</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="n">fac</span><span class="o">/</span><span class="mi">1</span><span class="p">]).</span>

    <span class="n">start</span><span class="p">()</span> <span class="o">-&gt;</span>
        <span class="nv">N</span> <span class="o">=</span> <span class="n">fac</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
        <span class="nn">console</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="s">"factorial </span><span class="si">~p</span><span class="s">"</span><span class="p">,</span> <span class="p">[</span><span class="nv">J</span><span class="p">,</span> <span class="nv">N</span><span class="p">]).</span>

    <span class="n">fac</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">fac</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">N</span> <span class="o">*</span> <span class="n">fac</span><span class="p">(</span><span class="nv">N</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span>
</pre></div>

<p>Compile with Erlang:</p>

<pre><code>$ erlc shen.erl
$ erlc -pa . fac.erl
</code></pre>

<p>And you will get fac.js:</p>

<div class="highlight highlight-javascript"><pre>    <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"matches"</span><span class="p">).</span><span class="nx">pattern</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">({</span>
        <span class="s1">''</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">j</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
            <span class="nx">n</span> <span class="o">=</span> <span class="nx">fac</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'factorial ~p'</span><span class="p">,[</span><span class="nx">j</span><span class="p">,[</span><span class="nx">n</span><span class="p">,[]]]);</span>
    <span class="p">}});</span>
    <span class="kd">var</span> <span class="nx">fac</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">({</span>
        <span class="s1">'0'</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="s1">'n'</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">n</span> <span class="o">*</span> <span class="nx">fac</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}});</span>
    <span class="nx">start</span><span class="p">();</span>
</pre></div>

<p>Now you can check:</p>

<pre><code>$ node fac.js
factorial ~p [ 5, [ 120, [] ] ]
</code></pre>

<h2>
<a name="javascript-macros" class="anchor" href="#javascript-macros"><span class="octicon octicon-link"></span></a>JavaScript Macros</h2>

<p>Let say we want to generate JavaScript in our Erlang code which is very useful
for Server-Logic Event System, so you can write programs in Erlang and expand
them into JavaScript using -jsmacro attribute. Specified functions will be
expanded to JavaScript during compilation.</p>

<div class="highlight highlight-erlang"><pre>    <span class="o">-</span><span class="n">module</span><span class="p">(</span><span class="n">fac</span><span class="p">).</span>
    <span class="o">-</span><span class="n">compile</span><span class="p">({</span><span class="n">parse_transform</span><span class="p">,</span> <span class="n">shen</span><span class="p">}).</span>
    <span class="o">-</span><span class="n">compile</span><span class="p">(</span><span class="n">export_all</span><span class="p">).</span>

    <span class="o">-</span><span class="n">jsmacro</span><span class="p">([</span><span class="n">macro</span><span class="o">/</span><span class="mi">3</span><span class="p">]).</span>

    <span class="n">macro</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="nv">B</span><span class="p">,</span><span class="nv">C</span><span class="p">)</span> <span class="o">-&gt;</span>
        <span class="nn">ws</span><span class="p">:</span><span class="nb">send</span><span class="p">(</span><span class="nn">'Bert'</span><span class="p">:</span><span class="nf">encodebuf</span><span class="p">(</span>
            <span class="p">[{</span><span class="n">source</span><span class="p">,</span><span class="nn">'Bert'</span><span class="p">:</span><span class="nf">binary</span><span class="p">(</span><span class="nv">A</span><span class="p">)},</span>
             <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="nv">C</span><span class="p">},</span>
             <span class="p">{</span><span class="n">pickle</span><span class="p">,</span><span class="nn">'Bert'</span><span class="p">:</span><span class="nf">binary</span><span class="p">(</span><span class="nv">B</span><span class="p">)},</span>
             <span class="p">{</span><span class="n">linked</span><span class="p">,</span><span class="nv">C</span><span class="p">}])).</span>

    <span class="n">main</span><span class="p">()</span> <span class="o">-&gt;</span>
        <span class="nv">A</span> <span class="o">=</span> <span class="s">"1"</span><span class="p">,</span>
        <span class="nv">B</span> <span class="o">=</span> <span class="s">"2"</span><span class="p">,</span>
        <span class="nv">Script</span> <span class="o">=</span> <span class="n">macro</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="nv">B</span><span class="p">,</span><span class="s">"3"</span><span class="p">),</span>
        <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">"JS Macro: </span><span class="si">~s</span><span class="s">"</span><span class="p">,[</span><span class="nv">Script</span><span class="p">]).</span>
</pre></div>

<p>Lets try it:</p>

<pre><code>7&gt; fac:main().
JS Macro: ws.send(Bert.encodebuf({source:Bert.binary(1),x:3,pickle:Bert.binary(2),linked:3}));
ok
</code></pre>

<h2>
<a name="roadmap" class="anchor" href="#roadmap"><span class="octicon octicon-link"></span></a>Roadmap</h2>

<ol>
<li>multiple clauses for lambdas</li>
<li>list comprehensions</li>
<li>more JavaScript/OTP mappings</li>
<li>if statement :-)</li>
</ol><h2>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h2>

<pre><code>* Maxim Sokhatsky
* Andrew Zadorozhny
</code></pre>

<p>OM A HUM</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">SHEN maintained by <a href="https://github.com/5HT">5HT</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
